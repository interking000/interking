<!DOCTYPE html>
<html lang="es" translate="no" data-bs-theme="light">

<head>
  <meta charset="utf-8">
  <base href="/" target="_blank">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="google" content="notranslate">
  <link rel="shortcut icon" href="../static/img/favicon.svg" />
  <title>KING•VPN - Configuraciones</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- LIBRARÍAS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <link rel="stylesheet" href="../static/css/styles.css">
  <link rel="stylesheet" href="../static/css/bootstrap.css">
  <link rel="stylesheet" href="../static/css/sidebar.css">
  <link rel="stylesheet" href="../static/css/header.css">
  <script src="../static/js/dark_light.js"></script>
  <script src="//code.jquery.com/jquery-2.1.0.min.js"></script>
  <link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" rel="stylesheet" />
  <meta name="csrf-token" content="<%= it.csrfToken %>">

  <!-- ESTILOS 3D PRO -->
  <style>
    :root {
      --bg-base: #f2f2f2;
      --bg-card: #ffffff;
      --text-main: #1a1a1a;

      --btn-grad-start: #dcdcdc;
      --btn-grad-end: #b0b0b0;
      --btn-border: #999;

      --input-bg: #fff;
      --input-border: #cfcfcf;

      --shadow-dark: 4px 4px 12px rgba(0,0,0,0.4);
      --shadow-light: -4px -4px 12px rgba(255,255,255,0.05);
    }

    [data-bs-theme="dark"] {
      --bg-base: #0d0d0d;
      --bg-card: #141414;
      --text-main: #eaeaea;

      --btn-grad-start: #1a1a1a;
      --btn-grad-end: #111;
      --btn-border: #2a2a2a;

      --input-bg: #1a1a1a;
      --input-border: #333;

      --shadow-dark: 4px 4px 12px #000;
      --shadow-light: -4px -4px 12px rgba(255,255,255,0.05);
    }

    body {
      background: var(--bg-base) !important;
      color: var(--text-main) !important;
    }

    .card {
      background: var(--bg-card) !important;
      border-radius: 18px;
      box-shadow: var(--shadow-dark), var(--shadow-light);
    }

    input,
    select,
    textarea {
      background: var(--input-bg) !important;
      border: 1px solid var(--input-border) !important;
      color: var(--text-main) !important;
    }

    /* BOTONES 3D MEJORADOS */
    .btn-dark {
      background: linear-gradient(145deg, var(--btn-grad-start), var(--btn-grad-end)) !important;
      border: 1px solid var(--btn-border) !important;
      color: var(--text-main) !important;
      font-weight: 600;
      border-radius: 12px;
      box-shadow:
        inset 1px 1px 2px rgba(0,0,0,0.2),
        inset -1px -1px 2px rgba(255,255,255,0.05),
        3px 3px 6px rgba(0,0,0,0.25);
      transition: 0.2s ease-in-out;
    }

    .btn-dark:hover {
      transform: translateY(-2px);
      box-shadow:
        inset 1px 1px 2px rgba(0,0,0,0.2),
        inset -1px -1px 2px rgba(255,255,255,0.05),
        5px 5px 12px rgba(0,0,0,0.3);
    }

    .btn-dark:active {
      transform: translateY(1px);
      box-shadow:
        inset 2px 2px 4px rgba(0,0,0,0.25),
        inset -2px -2px 4px rgba(255,255,255,0.05);
    }

    h1 {
      font-weight: bold;
      letter-spacing: 1px;
    }

    .edit-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 10px;
    }

    .edit-form label {
      font-weight: bold;
      font-size: 0.9rem;
    }

    .edit-preview {
      border: 1px solid var(--input-border);
      border-radius: 8px;
      padding: 10px;
      min-height: 50px;
      background: var(--input-bg);
      color: var(--text-main);
      font-weight: 500;
    }
  </style>
</head>

<body>
  <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>

  <main class="d-flex">
    <%~ include("./sidebar", it) %>

    <div class="container-fluid p-0">
      <%~ include("./header", it) %>

      <div class="content pt-1 overflow-auto">
        <div class="card shadow border border-0 overflow-auto h-100">
          <div class="card-body m-0">

            <h1 class="h3 mb-4 text-uppercase">Configuraciones</h1>

            <!-- BARRA SUPERIOR -->
            <div class="d-md-flex justify-content-between mb-3 align-items-center">

              <!-- BUSCADOR + ESTADO -->
              <div class="d-flex flex-column mb-1">
                <div class="d-flex">
                  <div class="mb-1 me-1">
                    <select class="form-select config-status">
                      <option value="ACTIVE">ACTIVO</option>
                      <option value="INACTIVE">INACTIVO</option>
                      <option value="ALL">TODO</option>
                    </select>
                  </div>

                  <div class="search-config input-group mb-1">
                    <input class="form-control" type="search" placeholder="Buscar configuración">
                    <button class="input-group-text border-1">
                      <i class="bi bi-search"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- BOTONES -->
              <div class="d-flex flex-column">
                <div class="d-flex mb-1" style="min-width: 300px;">
                  <button class="btn btn-dark flex-fill me-1 w-50 create-config">
                    <i class="bi bi-plus-lg"></i> CREAR
                  </button>
                  <button class="btn btn-dark flex-fill w-50 import-config">
                    <i class="bi bi-file-earmark-arrow-up"></i> IMPORTAR
                  </button>
                </div>

                <div class="d-flex">
                  <button class="btn btn-dark flex-fill me-1 w-50 export-config">
                    <i class="bi bi-file-earmark-arrow-down"></i> EXPORTAR
                  </button>
                  <button class="btn btn-dark flex-fill w-50 delete-config">
                    <i class="bi bi-trash"></i> ELIMINAR
                  </button>
                </div>

                <button class="btn btn-dark flex-fill mt-1 w-md-50 release-update invisible">
                  <i class="bi bi-send"></i> EDITAR NOTAS
                </button>
              </div>
            </div>

            <div id="root"></div>

            <!-- Formulario de edición -->
            <div id="edit-container" class="d-none">
              <form class="edit-form">
                <label for="edit-name">Nombre:</label>
                <input id="edit-name" type="text" class="form-control">

                <label for="edit-category">Categoría:</label>
                <select id="edit-category" class="form-select">
                  <option value="">Seleccione una categoría</option>
                </select>

                <label for="edit-order">Orden:</label>
                <input id="edit-order" type="number" class="form-control">

                <label for="edit-mode">Modo:</label>
                <select id="edit-mode" class="form-select">
                  <option value="ONLINE">ONLINE</option>
                  <option value="OFFLINE">OFFLINE</option>
                </select>

                <label>Previsualización:</label>
                <div class="edit-preview" id="edit-preview"></div>

                <button type="button" class="btn btn-dark mt-2 save-edit">Guardar</button>
              </form>
            </div>

            <div class="d-none config-not-found text-center p-3">
              <h4 class="text-muted">No se encontraron configuraciones</h4>
            </div>

            <div id="pagination"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="../static/js/sidebar.js"></script>
  <script src="../static/js/utils.js"></script>

  <script>
    const startLoader = () => {
      const html = `
        <div class="table-responsive text-center rounded">
            <table class="table table-striped mb-3">
                <thead>
                    <tr>
                        <th><input class="form-check-input" type="checkbox" onclick="table.toggleCheckAll(this.checked)"></th>
                        <th>#</th>
                        <th>Nombre</th>
                        <th>Categoría</th>
                        <th>Orden</th>
                        <th>Modo</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th><input class="form-check-input" type="checkbox"></th>
                        <td class="name-cell"></td>
                        <td class="category-cell"></td>
                        <td class="order-cell"></td>
                        <td class="mode-cell"></td>
                        <td class="status-cell"></td>
                        <td class="actions-cell"></td>
                    </tr>
                </tbody>
            </table>
        </div>
      `;
      const root = document.querySelector('#root');
      root.innerHTML = html;
    }

    function openEditForm(config) {
      const container = document.getElementById('edit-container');
      container.classList.remove('d-none');

      document.getElementById('edit-name').value = config.name || '';
      const categorySelect = document.getElementById('edit-category');
      categorySelect.innerHTML = '';
      config.categories.forEach(cat => {
        const opt = document.createElement('option');
        opt.value = cat.id;
        opt.textContent = cat.name;
        if (cat.id === config.categoryId) opt.selected = true;
        categorySelect.appendChild(opt);
      });

      document.getElementById('edit-order').value = config.order || 0;
      document.getElementById('edit-mode').value = config.mode || 'ONLINE';
      document.getElementById('edit-preview').textContent = `Nombre: ${config.name}, Categoría: ${config.categoryName}, Orden: ${config.order}, Modo: ${config.mode}`;
    }

    document.querySelector('.save-edit').addEventListener('click', () => {
      const name = document.getElementById('edit-name').value;
      const categoryId = document.getElementById('edit-category').value;
      const order = document.getElementById('edit-order').value;
      const mode = document.getElementById('edit-mode').value;

      Toastify({
        text: "Configuración guardada correctamente",
        duration: 2500,
        gravity: "top",
        position: "right",
        backgroundColor: "#4fbe87"
      }).showToast();
    });
  </script>

  <script type="module" src="../static/js/config/main.js"></script>

</body>
</html>